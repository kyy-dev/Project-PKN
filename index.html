<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta http-equiv="Content-Security-Policy" content="default-src 'self' * 'unsafe-inline' 'unsafe-eval' data: blob: https:;">


    <title>NusantaraEdu Supreme - Ky Dev</title>

    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&family=Space+Grotesk:wght@300;500;700&display=swap" rel="stylesheet">

    <style>
/* Tambahkan di dalam <style> */
.modal-content {
    -webkit-touch-callout: none; /* Matikan menu copy-paste di iOS */
    -webkit-user-select: none;   /* Matikan seleksi teks */
    user-select: none;
}



        :root {
            --primary-green: #2d6a4f;
            --mid-green: #52b788;
            --light-green: #d8f3dc;
            --cream: #fefae0;
            --orange-accent: #f3722c;
            --dark-bg: #0b120e;
            --dark-card: #161e19;
            --text-dark: #1b4332;
            --text-light: #f8f9fa;
            --glass: rgba(255, 255, 255, 0.8);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body { 
            font-family: 'Space Grotesk', sans-serif; 
            background-color: var(--cream); 
            color: var(--text-dark); 
            transition: background 0.4s, color 0.4s;
            overflow-x: hidden;
            min-height: 100vh;
        }

        body.dark-mode { 
            background-color: var(--dark-bg); 
            color: var(--text-light); 
            --glass: rgba(22, 30, 25, 0.9);
        }

        /* --- PRELOADER --- */
        #preloader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--primary-green);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 99999; transition: 0.8s cubic-bezier(0.77, 0, 0.175, 1);
        }
        .load-logo { font-family: 'Fredoka'; color: white; font-size: 2.2rem; margin-bottom: 20px; animation: pulse 1.5s infinite; }
        .load-bar { width: 180px; height: 4px; background: rgba(255,255,255,0.2); border-radius: 10px; overflow: hidden; }
        .load-progress { width: 0%; height: 100%; background: var(--orange-accent); animation: progress 2.2s ease forwards; }
        @keyframes pulse { 0% { opacity: 0.6; transform: scale(0.95); } 50% { opacity: 1; transform: scale(1); } 100% { opacity: 0.6; transform: scale(0.95); } }
        @keyframes progress { to { width: 100%; } }

        /* --- NOTIFIKASI --- */
        #customAlert {
            position: fixed; top: -100px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 450px; background: var(--glass); backdrop-filter: blur(15px);
            padding: 15px 20px; border-radius: 30px; box-shadow: 0 15px 35px rgba(0,0,0,0.2);
            display: flex; align-items: center; gap: 15px; z-index: 100000;
            transition: 0.7s cubic-bezier(0.68, -0.6, 0.32, 1.6);
            border: 1px solid rgba(255,255,255,0.1);
        }
        #customAlert.active { top: 20px; }

        /* --- NAVBAR --- */
        .navbar {
            position: fixed; top: 0; left: 0; width: 100%;
            padding: 15px 5%;
            display: flex; justify-content: space-between; align-items: center;
            z-index: 1000; transition: 0.4s;
        }
        .navbar.scrolled { background: var(--glass); backdrop-filter: blur(10px); box-shadow: 0 4px 20px rgba(0,0,0,0.05); }
        .logo { font-family: 'Fredoka'; font-weight: 600; font-size: 1.4rem; color: var(--primary-green); user-select: none; }
        body.dark-mode .logo { color: var(--mid-green); }
        .menu-btn { background: var(--primary-green); color: white; border: none; width: 45px; height: 45px; border-radius: 15px; cursor: pointer; display: grid; place-items: center; }

        .side-menu {
            position: fixed; top: 0; right: -100%; width: 300px; height: 100%;
            background: var(--glass); backdrop-filter: blur(25px); z-index: 10001;
            transition: 0.5s cubic-bezier(0.77, 0, 0.175, 1); padding: 80px 25px;
            box-shadow: -10px 0 30px rgba(0,0,0,0.1); overflow-y: auto;
        }
        .side-menu.active { right: 0; }
        .menu-item { 
            padding: 14px 18px; border-radius: 16px; margin-bottom: 10px; 
            display: flex; align-items: center; gap: 12px; cursor: pointer;
            transition: 0.3s; font-weight: 600; text-decoration: none; color: inherit;
            background: rgba(255,255,255,0.3); border: 1px solid rgba(0,0,0,0.05);
        }
        .menu-item:hover { background: var(--mid-green); color: white; }

        /* --- SEARCH & TAGS --- */
        .search-area { padding: 130px 20px 20px; text-align: center; }
        .search-wrapper { 
            display: flex; background: white; border-radius: 50px; padding: 6px; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.05); max-width: 600px; margin: auto;
        }
        body.dark-mode .search-wrapper { background: var(--dark-card); }
        .search-bar { flex: 1; border: none; padding: 0 20px; outline: none; background: transparent; color: inherit; font-size: 16px; }

        .tag-container { display: flex; overflow-x: auto; gap: 10px; padding: 20px 5%; scrollbar-width: none; }
        .tag-container::-webkit-scrollbar { display: none; }
        .tag { white-space: nowrap; padding: 10px 25px; background: white; border-radius: 50px; font-size: 0.85rem; transition: 0.3s; box-shadow: 0 4px 10px rgba(0,0,0,0.02); cursor: pointer; }
        body.dark-mode .tag { background: var(--dark-card); }
        .tag.active { background: var(--primary-green); color: white; }

        /* --- GRID & CARDS --- */
        .container { padding: 0 20px 100px; max-width: 1200px; margin: auto; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .card { 
            background: white; border-radius: 28px; overflow: hidden; 
            box-shadow: 0 10px 20px rgba(0,0,0,0.03); transition: 0.4s;
            animation: slideIn 0.6s ease-out forwards;
        }
        body.dark-mode .card { background: var(--dark-card); }
        .card:hover { transform: translateY(-10px); box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
        @keyframes slideIn { from { transform: translateY(40px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        /* Organisasi Section */
        .org-section {
            background: var(--primary-green); color: white;
            padding: 35px 25px; border-radius: 35px; margin-bottom: 30px; text-align: center;
        }
        .org-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 20px; }
        .org-card { 
            background: rgba(255,255,255,0.1); padding: 15px; border-radius: 20px; 
            text-decoration: none; color: white; border: 1px solid rgba(255,255,255,0.1); transition: 0.3s;
            font-size: 0.9rem; font-weight: 500;
        }
        .org-card:hover { background: rgba(255,255,255,0.2); transform: scale(1.03); }

        /* --- MODAL --- */
        .overlay { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.85); backdrop-filter: blur(10px);
            display: none; justify-content: center; align-items: center; z-index: 100000;
        }
        .overlay.active { display: flex; }
        .modal-content { 
            background: var(--cream); padding: 35px 25px; border-radius: 35px; text-align: center;
            width: 92%; max-width: 420px; max-height: 85vh; overflow-y: auto;
        }
        body.dark-mode .modal-content { background: var(--dark-card); }

        .support-link {
            display: flex; align-items: center; gap: 15px; background: white;
            padding: 12px 20px; border-radius: 18px; margin-bottom: 10px;
            text-decoration: none; color: var(--text-dark); font-weight: bold;
            transition: 0.3s; border: 1px solid #eee;
        }
        body.dark-mode .support-link { background: #1f2923; color: white; border-color: #333; }

        footer { padding: 60px 20px; text-align: center; background: var(--primary-green); color: white; border-radius: 50px 50px 0 0; margin-top: 50px; }

        .leaf {
    position: fixed;
    top: -50px;
    z-index: 9999;
    pointer-events: none;
    animation: fall linear forwards;
}

@keyframes fall {
    0% { transform: translateY(0) rotate(0deg); opacity: 1; }
    100% { transform: translateY(110vh) rotate(720deg); opacity: 0; }
}

.badge-new {
    background: var(--orange-accent);
    color: white;
    font-size: 0.6rem;
    padding: 2px 8px;
    border-radius: 10px;
    margin-left: auto;
    animation: pulse 1s infinite;
}

.card-actions {
    display: flex;
    gap: 10px;
    margin-top: 15px;
    padding-top: 15px;
    border-top: 1px dashed #eee;
}
.btn-action {
    flex: 1;
    padding: 8px;
    border-radius: 12px;
    border: none;
    font-size: 0.7rem;
    cursor: pointer;
    font-weight: bold;
    transition: 0.3s;
}
.btn-copy { background: var(--light-green); color: var(--primary-green); }
.btn-share { background: var(--orange-accent); color: white; }
.btn-action:active { transform: scale(0.9); }

.recommendation-section {
    padding: 20px 0;
    margin-bottom: 30px;
}
.rec-title {
    font-family: 'Fredoka';
    color: var(--primary-green);
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 10px;
}
.rec-grid {
    display: flex;
    overflow-x: auto;
    gap: 15px;
    padding-bottom: 10px;
    scrollbar-width: none; /* Hide scrollbar Firefox */
}
.rec-grid::-webkit-scrollbar { display: none; } /* Hide scrollbar Chrome/Safari */

.rec-card {
    min-width: 240px;
    background: white;
    border-radius: 20px;
    padding: 10px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.05);
    border: 1px solid rgba(0,0,0,0.05);
}
body.dark-mode .rec-card { background: var(--dark-card); border-color: #333; }

.rec-img {
    width: 100%;
    height: 120px;
    border-radius: 15px;
    object-fit: cover;
}
.rec-info h4 { font-size: 0.9rem; margin-top: 10px; color: var(--primary-green); }
.rec-info p { font-size: 0.7rem; opacity: 0.7; margin-top: 4px; }
.btn-visit {
    display: block;
    margin-top: 10px;
    padding: 8px;
    background: var(--light-green);
    color: var(--primary-green);
    text-align: center;
    border-radius: 10px;
    font-size: 0.7rem;
    font-weight: bold;
    text-decoration: none;
}

/* --- QUIZ STYLES --- */
.quiz-option {
    display: block;
    width: 100%;
    padding: 12px 18px;
    margin-bottom: 10px;
    border: 2px solid #eee;
    border-radius: 15px;
    background: white;
    cursor: pointer;
    transition: 0.3s;
    font-size: 0.9rem;
    text-align: left;
}
.quiz-option:hover { border-color: var(--mid-green); background: var(--light-green); }
.quiz-option.correct { background: #d1fae5; border-color: #10b981; color: #065f46; font-weight: bold; }
.quiz-option.wrong { background: #fee2e2; border-color: #ef4444; color: #991b1b; }
.score-circle {
    width: 100px; height: 100px; 
    border-radius: 50%; background: var(--primary-green);
    color: white; display: flex; align-items: center; justify-content: center;
    font-size: 2rem; font-weight: bold; margin: 20px auto;
    box-shadow: 0 10px 20px rgba(45, 106, 79, 0.3);
}

/* Animasi Loading untuk Pengiriman Skor */
@keyframes loadingProgress {
    0% { width: 0%; left: 0; }
    50% { width: 70%; left: 15%; }
    100% { width: 100%; left: 100%; }
}

.load-bar {
    position: relative;
    overflow: hidden;
    background: #e2e8f0; /* Warna dasar abu-abu terang */
    border-radius: 10px;
}

.load-progress-animate {
    position: absolute;
    height: 100%;
    background: var(--orange-accent);
    animation: loadingProgress 2s infinite linear;
}

/* Tambahan agar teks status lebih rapi */
#statusKirim {
    transition: all 0.3s ease;
    min-height: 50px;
}

    </style>
</head>
<body>

   <div id="preloader">
        <div class="load-logo">üáÆüá© NusantaraEdu</div>
        <div class="load-bar"><div class="load-progress"></div></div>
        <p style="color: white; margin-top: 15px; font-size: 0.8rem; letter-spacing: 2px;">BY KY DEV</p>
    </div>

    <div class="side-menu" id="sideMenu">
        <h2 style="font-family: 'Fredoka'; margin-bottom: 25px; color: var(--primary-green);">Nusantara Menu</h2>
        <div class="menu-item" onclick="toggleDarkMode()">üåì Mode Tampilan</div>
        <div class="menu-item" onclick="showDevMenu()" style="background: rgba(45, 106, 79, 0.1); border: 1px solid var(--primary-green);">
    üöÄ Developer Info <span class="badge-new">OWNER</span>
</div>
<div class="menu-item" onclick="showUpdateAnnouncement()" style="background: rgba(0, 123, 255, 0.1); border: 1px solid #007bff;">
    üì¢ Log Pembaruan <span class="badge-new" style="background: #007bff;">V1.2</span>
</div>

        <div class="menu-item" onclick="showOrgModal()">üö© Gabung Organisasi</div>
        <div class="menu-item" onclick="showSupport()">ü§ù Support Dev</div>
        <div class="menu-item" onclick="reportBug()">üêú Lapor Kendala</div>
        <hr style="margin: 20px 0; opacity: 0.1;">
        <a href="https://github.com/ky-dev2" target="_blank" class="menu-item">üêô GitHub Profile</a>
        <div class="menu-item" onclick="showSekolah()">
    üè´ Tentang Sekolahku <span class="badge-new">NEW</span>
</div>
<div class="menu-item" onclick="startQuiz()" style="background: rgba(243, 114, 44, 0.1); border: 1px solid var(--orange-accent);">
    üß† Uji Wawasan (Kuis) <span class="badge-new">SERU</span>
</div>
<div class="menu-item" onclick="showLeaderboard()" style="background: rgba(255, 215, 0, 0.1); border: 1px solid #ffd700;">
    üèÜ Papan Peringkat <span class="badge-new">TOP 5</span>
</div>
<div class="menu-item" onclick="showBetaDownload()" style="background: rgba(45, 106, 79, 0.1); border: 1px solid var(--primary-green); position: relative;">
    üì± NusantaraEdu App <span class="badge-new" style="background: #007bff;">BETA</span>
</div>
<div class="menu-item" onclick="showCredits()">üôè Kredit & Apresiasi</div>





        <button onclick="toggleMenu()" style="background:var(--orange-accent); color:white; border:none; padding:14px; width:100%; border-radius:18px; margin-top:30px; font-weight:bold; cursor:pointer;">Tutup</button>
    </div>

    <nav class="navbar" id="mainNav">
        <div class="logo">üáÆüá© NusantaraEdu</div>
        <button class="menu-btn" onclick="toggleMenu()">‚ò∞</button>
    </nav>

    <div class="search-area">
        <h1 style="font-family:'Fredoka'; color:var(--primary-green); margin-bottom:15px;">Eksplorasi Budaya</h1>
        <div class="search-wrapper">
            <input type="text" id="userInput" class="search-bar" placeholder="Cari: Wayang, Rendang, Batik...">
            <button onclick="searchCulture()" style="background:var(--orange-accent); color:white; border:none; width:45px; height:45px; border-radius:50%; cursor:pointer;">üîç</button>
        </div>
    </div>

    <div class="tag-container">
        <div class="tag active" onclick="updateCategory('acak', this)">üè† Beranda</div>
        <div class="tag" onclick="updateCategory('Seni', this)">üé® Seni Budaya</div>
        <div class="tag" onclick="updateCategory('Kuliner', this)">üç≤ Kuliner</div>
        <div class="tag" onclick="updateCategory('Tempat', this)">üèõÔ∏è Wisata</div>
    </div>

    <main class="container">
        <div class="org-section">
            <h2 style="font-family:'Fredoka'; margin-bottom: 10px;">Ayo Lestarikan Budaya!</h2>
            <p style="font-size: 0.85rem; opacity: 0.9; margin-bottom: 20px;">Kunjungi situs resmi pemerintah untuk informasi lebih dalam.</p>
            <div class="org-grid">
                <a href="https://iha.kemenbud.go.id/" target="_blank" class="org-card">üèõÔ∏è Indonesia Heritage Agency</a>
                <a href="https://indonesia.go.id/kategori/budaya" target="_blank" class="org-card">üé≠ Portal Budaya Indonesia</a>
                <a href="https://warisanbudaya.kemdikbud.go.id/" target="_blank" class="org-card">üìú Warisan Budaya Takbenda</a>
            </div>
        </div>

        <div class="grid" id="contentGrid"></div>
        <div id="scrollStatus" style="text-align:center; padding:30px; display:none; color:var(--mid-green);">üåø Menjelajah lebih dalam...</div>
    </main>

    <div class="overlay" id="modalOverlay">  
        <div class="modal-content">  
            <h2 id="modalTitle" style="font-family: 'Fredoka'; color: var(--primary-green); margin-bottom: 20px;">Info</h2>  
            <div id="modalBody"></div>
            <button onclick="closeModal()" style="background: var(--primary-green); color: white; border: none; padding: 14px; border-radius: 50px; font-weight: bold; width: 100%; margin-top: 20px; cursor:pointer;">Tutup</button>  
        </div>  
    </div>

    <footer>
        <p style="font-family: 'Fredoka'; font-size: 1.3rem;">Fadhillah Dzaki Nasrullah</p>
        <p style="font-size: 0.75rem; margin-top: 8px; opacity: 0.7;">Project Edukasi PKN - SMP 2 Cawas</p>
    </footer>

    <script>
      const kalenderBudaya = [
    { "tgl": "01-01", "event": "Tahun Baru & Semangat Budaya", "pesan": "Awali tahun dengan semangat melestarikan budaya Nusantara!" },
    { "tgl": "02-21", "event": "Hari Bahasa Ibu Internasional", "pesan": "Jangan lupa gunakan bahasa daerahmu hari ini! üó£Ô∏è" },
    { "tgl": "03-09", "event": "Hari Musik Nasional", "pesan": "Ayo dengarkan instrumen tradisional seperti Angklung atau Gamelan! üé∂" },
    { "tgl": "04-21", "event": "Hari Kartini", "pesan": "Habis Gelap Terbitlah Terang. Mari teladani perjuangan Ibu Kartini. üëó" },
    { "tgl": "05-02", "event": "Hari Pendidikan Nasional", "pesan": "Ing Ngarsa Sung Tuladha. Semangat belajar untuk masa depan! üìö" },
    { "tgl": "06-01", "event": "Hari Lahir Pancasila", "pesan": "Pancasila adalah pemersatu keberagaman budaya kita. üáÆüá©" },
    { "tgl": "08-17", "event": "Hari Kemerdekaan RI", "pesan": "Merdeka! Rayakan kemerdekaan dengan bangga akan budaya sendiri!" },
    { "tgl": "10-02", "event": "Hari Batik Nasional", "pesan": "Selamat Hari Batik! Warisan dunia dari Indonesia untuk jagat raya. üëî" },
    { "tgl": "10-28", "event": "Hari Sumpah Pemuda", "pesan": "Satu nusa, satu bangsa, satu bahasa. Salam pemuda! ‚úä" },
    { "tgl": "11-07", "event": "Hari Wayang Nasional", "pesan": "Mari apresiasi mahakarya seni pertunjukan wayang hari ini. üë∫" },
    { "tgl": "11-10", "event": "Hari Pahlawan", "pesan": "Bangsa yang besar adalah bangsa yang menghargai jasa pahlawannya. üéñÔ∏è" },
    { "tgl": "12-22", "event": "Hari Ibu", "pesan": "Terima kasih untuk seluruh Ibu yang melestarikan budaya di rumah. ‚ù§Ô∏è" }
];

function cekEventHariIni() {
    const sekarang = new Date();
    // Format tanggal ke MM-DD agar sesuai dengan JSON
    const bulan = String(sekarang.getMonth() + 1).padStart(2, '0');
    const tanggal = String(sekarang.getDate()).padStart(2, '0');
    const tglKey = `${bulan}-${tanggal}`;

    // Cari apakah hari ini ada di kalender
    const temukanEvent = kalenderBudaya.find(e => e.tgl === tglKey);

    if (temukanEvent) {
        // Tunggu sebentar setelah preloader selesai, lalu munculkan modal
        setTimeout(() => {
            document.getElementById('modalTitle').innerText = `‚ú® ${temukanEvent.event}`;
            document.getElementById('modalBody').innerHTML = `
                <div style="background: var(--light-green); padding: 25px; border-radius: 20px; color: var(--primary-green); text-align: center;">
                    <h1 style="font-size: 3rem; margin-bottom: 10px;">üáÆüá©</h1>
                    <p style="font-weight: 600; line-height: 1.6;">${temukanEvent.pesan}</p>
                </div>
                <p style="font-size: 0.7rem; margin-top: 15px; opacity: 0.6;">Sistem Kalender Otomatis NusantaraEdu</p>
            `;
            document.getElementById('modalOverlay').classList.add('active');
            showNotif("Event Khusus", temukanEvent.event, "üéâ");
        }, 2000); 
    }
}


        const grid = document.getElementById('contentGrid');
        const searchInput = document.getElementById('userInput');

        // --- DATASET FAKTA UNIK (Generator 2000+ Variasi) ---
        const faktaSubjek = ["Candi Borobudur", "Rendang", "Bahasa Indonesia", "Komodo", "Wayang Kulit", "Angklung", "Batik", "Danau Toba", "Gamelan", "Kopi Luwak", "Burung Cendrawasih", "Pulau Jawa", "Suku Buton", "Raja Ampat", "Pencak Silat", "Tari Saman", "Kapal Phinisi", "Garis Khatulistiwa", "Gunung Jayawijaya", "Naskah Negarakertagama"];
        const faktaPredikat = ["adalah yang terbesar di dunia", "telah diakui oleh UNESCO", "memiliki sejarah lebih dari 1000 tahun", "menjadi simbol kebanggaan nasional", "merupakan warisan takbenda kemanusiaan", "hanya bisa ditemukan di bumi nusantara", "pernah dinobatkan sebagai yang terbaik secara global", "menginspirasi banyak kebudayaan di negara lain", "menyimpan misteri geologi yang luar biasa", "menjadi bukti kecerdasan nenek moyang kita", "adalah yang terbesar di dunia", "telah diakui oleh UNESCO", "memiliki sejarah lebih dari 1000 tahun", "menjadi simbol kebanggaan nasional", "merupakan warisan takbenda kemanusiaan", "hanya bisa ditemukan di bumi nusantara", "pernah dinobatkan sebagai yang terbaik secara global", "menginspirasi banyak kebudayaan luar negeri", "menyimpan misteri geologi yang luar biasa", "adalah bukti sistem sosial yang sangat maju"];
        const faktaObjek = ["dalam kategori warisan budaya.", "sebagai identitas bangsa Indonesia.", "yang menarik perhatian peneliti dunia.", "sejak puluhan dekade yang lalu.", "menurut catatan sejarah internasional.", "bagi kelestarian alam nusantara.", "di tengah perkembangan era modern.", "yang wajib kita jaga bersama.", "di bawah naungan hukum internasional.", "sebagai pilar pariwisata kita."];

                // --- DATASET MASSIVE (100+ PER KATEGORI) ---
        const collections = {
            acak: [
                "Wayang", "Batik", "Borobudur", "Rendang", "Angklung", "Pencak_Silat", "Keris", "Gamelan", "Soto", "Nasi_Goreng",
                "Prambanan", "Danau_Toba", "Raja_Ampat", "Tari_Saman", "Reog", "Kain_Ulos", "Kujang", "Rumah_Gadang", "Lurik",
                "Kopi_Luwak", "Tari_Kecak", "Tari_Piring", "Papeda", "Pempek", "Gudeg", "Lawang_Sewu", "Candi_Cetho", "Sasando",
                "Kolintang", "Tifa", "Rumah_Limas", "Joglo", "Tongkonan", "Honai", "Mandau", "Badik", "Rencong", "Tari_Barong",
                "Sate_Madura", "Bakso", "Rawon", "Opor_Ayam", "Nasi_Liwet", "Ayam_Betutu", "Es_Dawet", "Wingko_Babat", "Serabi",
                "Kue_Putu", "Klepon", "Bika_Ambon", "Tari_Jaipong", "Tari_Merak", "Seni_Ukir_Jepara", "Ondel-ondel", "Sisingaan",
                "Ketoprak", "Ludruk", "Lenong", "Wayang_Golek", "Wayang_Beber", "Gong", "Kenong", "Bonang", "Kendang", "Rebab",
                "Saron", "Siter", "Celempung", "Calung", "Bedug", "Tari_Tor-tor", "Tari_Gandrung", "Tari_Topeng", "Tari_Serimpi",
                "Tari_Bedhaya", "Tari_Baksa_Kembang", "Tari_Zapin", "Tari_Merak", "Tari_Sajojo", "Tari_Maengket", "Tari_Gambyong",
                "Tari_Pendet", "Tari_Legong", "Tari_Cakalele", "Tari_Gambo", "Sapeh", "Kledi", "Karinding", "Talempong", "Saluang",
                "Kecapi", "Suling", "Gambus", "Tehyan", "Batik_Solo", "Batik_Pekalongan", "Batik_Parang", "Batik_Megamendung",
                "Songket", "Kain_Tapis", "Kain_Tenun_Sumba", "Garis_Khatulistiwa", "Gunung_Bromo", "Kawah_Ijen", "Pulau_Komodo",
                "Taman_Mini_Indonesia_Indah", "Monumen_Nasional", "Museum_Nasional_Indonesia", "Benteng_Rotterdam", "Benteng_Vredeburg",
                "Istana_Maimun", "Keraton_Ngayogyakarta_Hadiningrat", "Keraton_Surakarta", "Masjid_Menara_Kudus", "Masjid_Raya_Baiturrahman",
                "Wae_Rebo", "Tana_Toraja", "Sangiran", "Pura_Besakih", "Tanah_Lot", "Bunaken", "Kepulauan_Derawan", "Danau_Kelimutu",
                "Gunung_Rinjani", "Pantai_Pandawa", "Candi_Sukuh", "Candi_Sewu", "Candi_Kalasan", "Benteng_Marlborough", "Lumpia_Semarang",
                "Tahu_Sumedang", "Mie_Aceh", "Coto_Makassar", "Es_Pisang_Ijo", "Bubur_Manado", "Kapurung", "Rujak_Cingur", "Kerak_Telor",
                "Nasi_Uduk", "Nasi_Kuning", "Sate_Lilit", "Gulai_Pakis", "Kue_Lumpur", "Lapis_Legit", "Martabak_Manis", "Soto_Lamongan"
            ],
            Seni: [
                "Wayang_Kulit", "Batik", "Angklung", "Pencak_Silat", "Keris", "Gamelan", "Tari_Saman", "Reog_Ponorogo", "Kain_Ulos",
                "Tari_Kecak", "Tari_Piring", "Sasando", "Kolintang", "Tifa", "Tari_Barong", "Tari_Jaipong", "Tari_Merak",
                "Seni_Ukir_Jepara", "Ondel-ondel", "Sisingaan", "Ketoprak", "Ludruk", "Lenong", "Wayang_Golek", "Wayang_Beber",
                "Gong", "Kenong", "Bonang", "Kendang", "Rebab", "Saron", "Siter", "Celempung", "Calung", "Bedug", "Tari_Tor-tor",
                "Tari_Gandrung", "Tari_Topeng", "Tari_Serimpi", "Tari_Bedhaya", "Tari_Baksa_Kembang", "Tari_Zapin", "Tari_Sajojo",
                "Tari_Maengket", "Tari_Gambyong", "Tari_Pendet", "Tari_Legong", "Tari_Cakalele", "Tari_Gambo", "Sapeh", "Kledi",
                "Karinding", "Talempong", "Saluang", "Kecapi", "Suling", "Gambus", "Tehyan", "Batik_Solo", "Batik_Pekalongan",
                "Batik_Parang", "Batik_Megamendung", "Songket", "Kain_Tapis", "Kain_Tenun_Sumba", "Kujang", "Mandau", "Badik",
                "Rencong", "Parang", "Celurit", "Kain_Ulos", "Lurik", "Sinden", "Macapat", "Debus", "Kuda_Lumping", "Tari_Topeng_Cirebon",
                "Seni_Lukis_Kamasan", "Ukir_Asmat", "Batik_Cirebon", "Tenun_Ikat", "Tari_Golek", "Wayang_Wong", "Tari_Piring",
                "Gamelan_Bali", "Gamelan_Sunda", "Gendang_Beleq", "Tari_Manyer_Sewu", "Tari_Piring", "Seni_Ukir_Bali", "Wayang_Sukur",
                "Tari_Bambu_Gila", "Tari_Pagar_Pengantin", "Seni_Ukir_Toraja", "Tari_Balean_Dadas", "Tari_Lilin", "Tari_Remo"
            ],
            Kuliner: [
                "Rendang", "Soto", "Nasi_Goreng", "Kopi_Luwak", "Papeda", "Pempek", "Gudeg", "Sate_Madura", "Bakso", "Rawon",
                "Opor_Ayam", "Nasi_Liwet", "Ayam_Betutu", "Es_Dawet", "Wingko_Babat", "Serabi", "Kue_Putu", "Klepon", "Bika_Ambon",
                "Lumpia_Semarang", "Tahu_Sumedang", "Mie_Aceh", "Coto_Makassar", "Es_Pisang_Ijo", "Bubur_Manado", "Kapurung",
                "Rujak_Cingur", "Kerak_Telor", "Nasi_Uduk", "Nasi_Kuning", "Sate_Lilit", "Gulai_Pakis", "Kue_Lumpur", "Lapis_Legit",
                "Martabak_Manis", "Soto_Lamongan", "Pecel_Lele", "Gado-gado", "Karedok", "Ketoprak_(makanan)", "Sayur_Asem",
                "Gulai_Kambing", "Sate_Padura", "Pindang_Patin", "Ayam_Taliwang", "Nasi_Padang", "Nasi_Ulam", "Bubur_Ayam",
                "Soto_Betawi", "Soto_Kudus", "Soto_Banjar", "Soto_Medan", "Mie_Kocok", "Mie_Cakalang", "Laksa", "Asinan_Bogor",
                "Tahu_Gejrot", "Seblak", "Batagor", "Siomay", "Cimol", "Cilor", "Kue_Cucur", "Kue_Balok", "Kue_Pancong", "Getuk",
                "Wajik", "Dodol_Garut", "Jenang", "Madumongso", "Tape_Singkong", "Peuyeum", "Roti_Buaya", "Binte_Biluhuta",
                "Pallubasa", "Konro", "Sop_Saudara", "Ikan_Bakar_Cianjur", "Ayam_Goreng_Kalasan", "Sate_Maranggi", "Sate_Kere",
                "Empal_Gentong", "Tahu_Campur", "Tahu_Tek", "Lontong_Kupang", "Nasi_Grombyang", "Nasi_Krawu", "Nasi_Pecel",
                "Ayam_Pop", "Dendeng_Balado", "Gulai_Otak", "Samba_Lado_Tanah", "Sate_Kajang", "Mie_Goreng_Jawa", "Bebek_Sinjay"
            ],
            Tempat: [
                "Borobudur", "Prambanan", "Danau_Toba", "Raja_Ampat", "Lawang_Sewu", "Candi_Cetho", "Rumah_Limas", "Joglo",
                "Tongkonan", "Honai", "Garis_Khatulistiwa", "Gunung_Bromo", "Kawah_Ijen", "Pulau_Komodo", "Taman_Mini_Indonesia_Indah",
                "Monumen_Nasional", "Museum_Nasional_Indonesia", "Benteng_Rotterdam", "Benteng_Vredeburg", "Istana_Maimun",
                "Keraton_Ngayogyakarta_Hadiningrat", "Keraton_Surakarta", "Masjid_Menara_Kudus", "Masjid_Raya_Baiturrahman",
                "Wae_Rebo", "Tana_Toraja", "Sangiran", "Pura_Besakih", "Tanah_Lot", "Bunaken", "Kepulauan_Derawan", "Danau_Kelimutu",
                "Gunung_Rinjani", "Pantai_Pandawa", "Candi_Sukuh", "Candi_Sewu", "Candi_Kalasan", "Benteng_Marlborough",
                "Benteng_Belgica", "Candi_Bala_Putra_Dewa", "Candi_Penataran", "Candi_Muara_Takus", "Taman_Nasional_Ujung_Kulon",
                "Taman_Nasional_Lore_Lindu", "Taman_Nasional_Lorentz", "Bukit_Lawang", "Kepulauan_Wakatobi", "Pulau_Weh",
                "Pantai_Ora", "Lembah_Harau", "Ngarai_Sianok", "Jam_Gadang", "Lubang_Buaya", "Gedung_Sate", "Jalan_Malioboro",
                "Pasar_Terapung", "Jembatan_Ampera", "Masjid_Istiqlal", "Gereja_Katedral_Jakarta", "Kelenteng_Sam_Poo_Kong",
                "Vihara_Avalokitesvara", "Istana_Bogor", "Istana_Cipanas", "Istana_Tampaksiring", "Taman_Sari_Yogyakarta",
                "Benteng_Speelwijk", "Benteng_Heritage", "Museum_Angkut", "Jatim_Park", "Taman_Safari_Indonesia", "Kawah_Putih",
                "Gunung_Tangkuban_Parahu", "Gunung_Merapi", "Gunung_Semeru", "Puncak_Jaya", "Pantai_Parangtritis", "Pantai_Kuta",
                "Pantai_Senggigi", "Gili_Trawangan", "Pulau_Samosir", "Banda_Neira", "Ternate", "Tidore", "Pulau_Bintan",
                "Pulau_Bangka", "Pulau_Belitung", "Pantai_Tanjung_Tinggi", "Danau_Sentani", "Danau_Singkarak", "Danau_Ranau"
            ]
        };

        const infiniteLibrary = [...collections.acak].sort(() => Math.random() - 0.5);


        let itemsLoaded = 0;
        let isFetching = false;
        let activeCategory = 'acak';

        // --- CORE FUNCTIONS ---
        function generateUniqueFact() {
            const s = faktaSubjek[Math.floor(Math.random() * faktaSubjek.length)];
            const p = faktaPredikat[Math.floor(Math.random() * faktaPredikat.length)];
            const o = faktaObjek[Math.floor(Math.random() * faktaObjek.length)];
            return `${s} ${p} ${o}`;
        }

        function showLoginFact() {
            const fact = generateUniqueFact();
            document.getElementById('modalTitle').innerText = "üí° Fakta Unik Hari Ini";
            document.getElementById('modalBody').innerHTML = `
                <div style="padding: 20px; background: var(--light-green); border-radius: 20px; color: var(--primary-green); font-weight: 500; line-height: 1.6;">
                    "${fact}"
                </div>
                <p style="margin-top: 15px; font-size: 0.75rem; opacity: 0.7;">Tahukah kamu? Indonesia memiliki ribuan cerita yang belum terungkap sepenuhnya.</p>
            `;
            document.getElementById('modalOverlay').classList.add('active');
        }

        function showNotif(title, msg, icon = "‚ú®") {
            const alertBox = document.getElementById('customAlert');
            document.getElementById('alertTitle').innerText = title;
            document.getElementById('alertMsg').innerText = msg;
            document.getElementById('alertIcon').innerText = icon;
            alertBox.classList.add('active');
            setTimeout(() => alertBox.classList.remove('active'), 3000);
        }

        function toggleMenu() { document.getElementById('sideMenu').classList.toggle('active'); }
        function closeModal() { document.getElementById('modalOverlay').classList.remove('active'); }

        async function fetchCulture(topic) {
    try {
        const res = await fetch(`https://id.wikipedia.org/api/rest_v1/page/summary/${topic}`);

        if (!res.ok) {
            throw new Error('Data tidak ditemukan atau server sibuk');
        }

        const data = await res.json();
        if (data.title === "Not found") return;

        // --- 1. LOGIKA MEMBERSIHKAN TEKS (DESKRIPSI) ---
        let cleanDesc = "";
        if (data.extract) {
            // Hapus teks dalam kurung (ejaan daerah/asing)
            cleanDesc = data.extract.replace(/\s*\([^)]*\)/g, "");

            const kalimatSampah = ["merujuk kepada", "dapat mengacu pada", "halaman disambiguasi"];
            const isSampah = kalimatSampah.some(kata => cleanDesc.toLowerCase().includes(kata));

            if (isSampah || cleanDesc.length < 25) {
                cleanDesc = `Mari mengenal lebih jauh tentang ${data.title}, salah satu kekayaan budaya kebanggaan Indonesia yang luar biasa.`;
            } else {
                cleanDesc = cleanDesc.substring(0, 115) + "...";
            }
        } else {
            cleanDesc = "Warisan kekayaan budaya nusantara yang menyimpan nilai sejarah tinggi.";
        }

        // --- 2. LOGIKA FILTER GAMBAR ---
        // Jika lebar gambar < 150px (biasanya ikon jelek), kita anggap kosong agar muncul teks maaf
        const imgUrl = (data.thumbnail && data.thumbnail.width > 150) ? data.thumbnail.source : "";

        // --- 3. PEMBUATAN KARTU (UI) ---
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
            <div style="position:relative; overflow:hidden; background: #f8f9fa; height:200px; display: flex; align-items: center; justify-content: center; text-align: center; border-bottom: 1px solid #eee;">
                
                <div style="position:absolute; padding: 20px; color: #718096; z-index: 1;">
                    <span style="font-size: 1.2rem; display: block; margin-bottom: 5px;">üåø</span>
                    <p style="font-size: 0.65rem; line-height: 1.4; margin: 0; font-style: italic;">
                        Mohon maaf, visual untuk <b>"${data.title}"</b> belum tersedia secara akurat saat ini.
                    </p>
                </div>

                ${imgUrl ? `
                <img src="${imgUrl}" 
                     style="width:100%; height:200px; object-fit:cover; position:relative; z-index:2;" 
                     onerror="this.style.display='none';">` : ''}
            </div>

            <div style="padding:22px;">
                <h3 style="color:var(--primary-green); font-size:1.1rem; margin-bottom:8px; font-family:'Fredoka';">${data.title}</h3>
                <p style="font-size:0.8rem; line-height:1.6; opacity:0.8; color: #4a5568; min-height: 60px;">
                    ${cleanDesc}
                </p>
                
                <div class="card-actions">
                    <button class="btn-action btn-copy" onclick="copyFact('${data.title}', '${cleanDesc.replace(/'/g, "\\'")}')">üìã Salin</button>
                    <button class="btn-action btn-share" onclick="shareWa('${data.title}')">üì≤ Share</button>
                </div>
                <a href="${data.content_urls.desktop.page}" target="_blank" style="display:block; text-align:center; margin-top:15px; color:var(--mid-green); font-weight:bold; font-size:0.65rem; text-decoration:none; opacity: 0.6;">PELAJARI VIA WIKIPEDIA ‚Üí</a>
            </div>
        `;

        grid.appendChild(card);

    } catch (error) {
        console.error("Fetch Error:", error);
    }
}


        async function updateCategory(cat, el) {
            if (isFetching) return;
            document.querySelectorAll('.tag').forEach(t => t.classList.remove('active'));
            el.classList.add('active');
            grid.innerHTML = '';
            itemsLoaded = 0;
            activeCategory = cat;
            for (const item of collections[cat]) {
                await fetchCulture(item);
            }
        }

        function searchCulture() {
            const val = searchInput.value.trim();
            if(!val) return;
            grid.innerHTML = '';
            fetchCulture(val.replace(/ /g, '_'));
        }

        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            showNotif("Mode", "Tampilan diubah", "üåì");
        }

        function showSupport() {
            toggleMenu();
            document.getElementById('modalTitle').innerText = "Support Ky Dev";
            document.getElementById('modalBody').innerHTML = `
                <a href="https://instagram.com/kycihuyy1" target="_blank" class="support-link">üì∏ Instagram</a>
                                <a href="https://tiktok.com/@kysnku" target="_blank" class="support-link">üéµ TikTok</a>
                <a href="https://saweria.co/Kydev" target="_blank" class="support-link">‚òï Saweria</a>
            `;
            document.getElementById('modalOverlay').classList.add('active');
        }

        function showOrgModal() {
            toggleMenu();
            document.getElementById('modalTitle').innerText = "Organisasi Resmi";
            document.getElementById('modalBody').innerHTML = `<p>Kunjungi situs resmi: kemenbud.go.id</p>`;
            document.getElementById('modalOverlay').classList.add('active');
        }

        function reportBug() {
    toggleMenu(); // Tutup menu samping

    document.getElementById('modalTitle').innerText = "üêú Lapor Kendala Aplikasi";
    document.getElementById('modalBody').innerHTML = `
        <div style="text-align: left; font-size: 0.9rem;">
            <p style="margin-bottom: 15px; opacity: 0.8;">Bantu kami meningkatkan <b>NusantaraEdu</b> dengan melaporkan kendala atau bug yang Anda temukan.</p>
            
            <div style="background: #fff5f5; border: 1px solid #feb2b2; padding: 15px; border-radius: 15px; margin-bottom: 20px;">
                <label style="display:block; font-weight:bold; font-size:0.75rem; color:#c53030; margin-bottom:5px;">DESKRIPSI KENDALA:</label>
                <textarea id="bugDesc" placeholder="Contoh: Gambar tidak muncul di menu kuliner..." style="width:100%; height:80px; border:none; background:transparent; outline:none; font-family:inherit; font-size:0.85rem; resize:none;"></textarea>
            </div>

            <div style="font-size: 0.7rem; color: #718096; margin-bottom: 20px; padding: 0 5px;">
                *Informasi perangkat (Versi Browser & OS) akan disertakan secara otomatis dalam laporan.
            </div>

            <button onclick="kirimBugKeEmail()" style="background: #c53030; color: white; border: none; padding: 15px; border-radius: 50px; width: 100%; font-weight: bold; cursor: pointer; box-shadow: 0 4px 12px rgba(197, 48, 48, 0.2);">
                üöÄ Kirim Laporan via Email
            </button>
        </div>
    `;
    document.getElementById('modalOverlay').classList.add('active');
}

// 1. Modifikasi Fungsi Lapor Bug (Ditambah Notif Hangat)
function kirimBugKeEmail() {
    const pesan = document.getElementById('bugDesc').value.trim();
    if (!pesan) {
        showNotif("Peringatan", "Mohon isi deskripsi kendala", "‚ö†Ô∏è");
        return;
    }

    const infoPerangkat = `Browser: ${navigator.userAgent} | Screen: ${window.innerWidth}x${window.innerHeight}`;
    const subject = encodeURIComponent(`LAPOR BUG: NusantaraEdu Supreme`);
    const body = encodeURIComponent(
        `HALO KY DEV,\n\n` +
        `SAYA MENEMUKAN KENDALA BERIKUT:\n` +
        `------------------------------------\n` +
        `"${pesan}"\n` +
        `------------------------------------\n\n` +
        `DATA TEKNIS:\n` +
        `- Waktu: ${new Date().toLocaleString()}\n` +
        `- Info: ${infoPerangkat}\n\n` +
        `Mohon segera diperiksa, terima kasih!`
    );

    window.location.href = `mailto:fadhillahnasrullah9@gmail.com?subject=${subject}&body=${body}`;

    closeModal();
}


        // --- SCROLL & INITIAL ---
        window.addEventListener('scroll', () => {
            const nav = document.getElementById('mainNav');
            nav.classList.toggle('scrolled', window.scrollY > 50);

            if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight - 1000) {
                if(!isFetching && activeCategory === 'acak' && itemsLoaded < infiniteLibrary.length) {
                    isFetching = true;
                    document.getElementById('scrollStatus').style.display = 'block';
                    const loadBatch = async () => {
                        await fetchCulture(infiniteLibrary[itemsLoaded]);
                        itemsLoaded++;
                        isFetching = false;
                        document.getElementById('scrollStatus').style.display = 'none';
                    };
                    loadBatch();
                }
            }
        });





        searchInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') searchCulture(); });

        function createLeaf() {
    const leaf = document.createElement('div');
    leaf.className = 'leaf';
    leaf.innerHTML = 'üçÉ';
    leaf.style.left = Math.random() * 100 + 'vw';
    leaf.style.fontSize = (Math.random() * 20 + 10) + 'px';

    // Perbaikan: gunakan style.animationDuration
    const duration = Math.random() * 3 + 4; 
    leaf.style.animationDuration = duration + 's';

    leaf.style.opacity = Math.random();
    document.body.appendChild(leaf);

    // Hapus daun setelah animasi selesai agar tidak membebani memori
    setTimeout(() => leaf.remove(), duration * 1000);
}
// Jalankan fungsi daun
setInterval(createLeaf, 1500); 

async function updateCategory(cat, el) {
    // Jika sedang memuat kategori yang sama, abaikan
    if (isFetching && activeCategory === cat) return;

    // Set status fetching
    isFetching = true; 

    // Visual feedback: Ubah tampilan tombol aktif
    document.querySelectorAll('.tag').forEach(t => t.classList.remove('active'));
    el.classList.add('active');

    // Reset konten
    grid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 50px;">üåø Memuat kekayaan budaya...</div>';
    itemsLoaded = 0;
    activeCategory = cat;

    try {
        const batch = collections[cat];
        // Kosongkan grid sebelum mengisi dengan data baru
        grid.innerHTML = ''; 

        // Memuat 15 item pertama saja agar tidak macet/lambat (opsional)
        for (const item of batch) {
            // Jika pengguna sudah pindah kategori lain saat ini masih loading, hentikan proses ini
            if (activeCategory !== cat) break; 
            await fetchCulture(item);
        }
    } catch (error) {
        console.error("Gagal memuat kategori:", error);
    } finally {
        // PENTING: Kunci dibuka kembali agar tombol lain bisa dipencet
        isFetching = false; 
    }
}

function showSekolah() {
    toggleMenu();
    document.getElementById('modalTitle').innerText = "Profil Resmi Sekolah";
    document.getElementById('modalBody').innerHTML = `
        <div style="text-align:left; font-size:0.85rem; line-height:1.5;">
            <div style="background:var(--primary-green); color:white; padding:20px; border-radius:20px; margin-bottom:15px; text-align:center;">
                <h3 style="font-family:'Fredoka'; margin-bottom:5px;">SMP NEGERI 2 CAWAS</h3>
                <p style="font-size:0.75rem; opacity:0.9;">NPSN: 20309592 | Akreditasi: A</p>
            </div>
            
            <div style="background:var(--light-green); padding:15px; border-radius:15px; margin-bottom:15px; color:var(--text-dark);">
                <p>üìç <b>Alamat:</b> Gombang Rt 01 Rw 01, Kec. Cawas, Kab. Klaten, Jawa Tengah.</p>
                <p>üë®‚Äçüè´ <b>Kepala Sekolah:</b> Eko Widodo</p>
                <p>üìö <b>Kurikulum:</b> Kurikulum SMP Merdeka</p>
            </div>

            <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:15px;">
                <div style="border:1px solid #ddd; padding:10px; border-radius:12px; text-align:center;">
                    <span style="display:block; font-size:1.2rem;">üë•</span>
                    <b>432</b><br>Total Siswa
                </div>
                <div style="border:1px solid #ddd; padding:10px; border-radius:12px; text-align:center;">
                    <span style="display:block; font-size:1.2rem;">üè¢</span>
                    <b>15</b><br>Rombel
                </div>
                <div style="border:1px solid #ddd; padding:10px; border-radius:12px; text-align:center;">
                    <span style="display:block; font-size:1.2rem;">üìñ</span>
                    <b>1</b><br>Perpustakaan
                </div>
                <div style="border:1px solid #ddd; padding:10px; border-radius:12px; text-align:center;">
                    <span style="display:block; font-size:1.2rem;">üß™</span>
                    <b>2</b><br>Laboratorium
                </div>
            </div>

            <p style="font-size:0.75rem; color:gray; text-align:center; font-style:italic;">
                "Sekolah Negeri dengan Luas Tanah 10.030 m¬≤ yang nyaman untuk belajar."
            </p>
            
            <a href="https://sekolah.data.kemendikdasmen.go.id/profil-sekolah/8034325A-2DF5-E011-ACC0-ADEF23297D2F" target="_blank" style="display:block; margin-top:15px; padding:12px; background:var(--orange-accent); color:white; text-decoration:none; border-radius:12px; font-weight:bold; text-align:center;">Cek Data Dapodik</a>
        </div>
    `;
    document.getElementById('modalOverlay').classList.add('active');
}

function showUpdateAnnouncement() {
    document.getElementById('modalTitle').innerText = "üöÄ UPDATE SUPREME V1.2";
    document.getElementById('modalBody').innerHTML = `
        <div style="text-align: left;">
            <div style="background: linear-gradient(135deg, #2d6a4f, #1b4332); color: white; padding: 18px; border-radius: 20px; margin-bottom: 20px; box-shadow: 0 10px 20px rgba(45, 106, 79, 0.2);">
                <h4 style="margin-bottom: 5px; display: flex; align-items: center; gap: 8px;">
                    Halo Patriot Budaya! üáÆüá©
                </h4>
                <p style="font-size: 0.75rem; opacity: 0.9;">Tiga fitur besar telah tiba untuk pengalaman belajar yang lebih seru!</p>
            </div>

            <h5 style="color: var(--primary-green); margin-bottom: 12px; font-size: 0.95rem;">üåü Fitur Baru Utama:</h5>
            
            <div style="display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px;">
                <div style="background: #fff7ed; border: 1px solid #ffedd5; padding: 12px; border-radius: 15px; display: flex; align-items: center; gap: 12px;">
                    <span style="font-size: 1.4rem;">üß†</span>
                    <div>
                        <strong style="font-size: 0.8rem; display: block; color: #9a3412;">Uji Wawasan (Kuis)</strong>
                        <span style="font-size: 0.65rem; color: #c2410c;">Tantang dirimu dengan 20 soal budaya & cetak sertifikat nilaimu!</span>
                    </div>
                </div>

                <div style="background: #fefce8; border: 1px solid #fef08a; padding: 12px; border-radius: 15px; display: flex; align-items: center; gap: 12px;">
                    <span style="font-size: 1.4rem;">üèÜ</span>
                    <div>
                        <strong style="font-size: 0.8rem; display: block; color: #854d0e;">Papan Peringkat</strong>
                        <span style="font-size: 0.65rem; color: #a16207;">Masuk daftar Top 5 Patriot Budaya dan jadilah yang terbaik di sekolah.</span>
                    </div>
                </div>

                <div style="background: #eff6ff; border: 1px solid #dbeafe; padding: 12px; border-radius: 15px; display: flex; align-items: center; gap: 12px;">
                    <span style="font-size: 1.4rem;">üì±</span>
                    <div>
                        <strong style="font-size: 0.8rem; display: block; color: #1e40af;">NusantaraEdu App (Beta)</strong>
                        <span style="font-size: 0.65rem; color: #1d4ed8;">Versi aplikasi Android (APK) kini sudah resmi dirilis untuk publik!</span>
                    </div>
                </div>
            </div>

            <div style="padding: 12px; background: #f8fafc; border-radius: 12px; border: 1px dashed #cbd5e1;">
                <p style="font-size: 0.7rem; color: #64748b; line-height: 1.4;">
                    <b>Lainnya:</b> Perbaikan sistem pencarian, optimasi loading API, dan fitur share WhatsApp.
                </p>
            </div>

            <p style="font-size: 0.65rem; color: gray; text-align: center; margin-top: 15px; font-style: italic;">
                Dibuat dengan semangat melestarikan budaya ‚Äî <b>Ky Dev</b>
            </p>
        </div>
    `;
    document.getElementById('modalOverlay').classList.add('active');
}


window.onload = () => {
    const preloader = document.getElementById('preloader');
    
    // 1. Fungsi Utama Penghilang Preloader
    const hilangkanPreloader = () => {
        if (preloader) {
            preloader.style.transform = 'translateY(-100%)';
            setTimeout(() => preloader.remove(), 800);
        }
    };

    // 2. TIMEOUT DARURAT (Failsafe)
    // Jika dalam 4 detik konten belum siap, paksa masuk agar tidak stuck di logo
    const forceLoad = setTimeout(() => {
        console.warn("Loading lambat, memaksa masuk...");
        hilangkanPreloader();
    }, 4000);

    // 3. JALANKAN PROSES PEMUATAN DATA
    setTimeout(async () => {
        try {
            // --- LOGIKA EVENT & FAKTA (Pop-up muncul di awal) ---
            const sekarang = new Date();
            const bulan = String(sekarang.getMonth() + 1).padStart(2, '0');
            const tanggal = String(sekarang.getDate()).padStart(2, '0');
            const tglKey = `${bulan}-${tanggal}`;
            const temukanEvent = kalenderBudaya.find(e => e.tgl === tglKey);

            const acakInfo = Math.random();
            if (temukanEvent) {
                (acakInfo > 0.3) ? tampilkanEventBudaya(temukanEvent) : showLoginFact();
            } else {
                (acakInfo < 0.75) ? showLoginFact() : showUpdateAnnouncement();
            }

            // --- SEGERA HILANGKAN PRELOADER DI SINI ---
            // Agar user bisa melihat UI Dashboard meskipun data grid belum muncul semua
            clearTimeout(forceLoad);
            hilangkanPreloader();

            // --- MUAT DATA KONTEN (Di latar belakang setelah masuk) ---
            const koleksiTeracak = [...collections.acak].sort(() => Math.random() - 0.5);
            grid.innerHTML = ''; // Bersihkan skeleton/grid
            
            // Muat 6-12 item pertama
            for (const item of koleksiTeracak.slice(0, 8)) {
                // Gunakan try-catch per item agar jika 1 error, yang lain tetap muncul
                try {
                    await fetchCulture(item);
                } catch (e) { 
                    console.error("Gagal muat item:", item);
                }
            }
            itemsLoaded = 8;

        } catch (err) {
            console.error("Kritis: Ada error di sistem loading:", err);
            hilangkanPreloader(); // Pastikan tetap masuk meskipun ada error fatal
        }
    }, 800); // Delay sedikit agar transisi halus
};


// Fungsi pembantu agar kode lebih bersih
function tampilkanEventBudaya(event) {
    document.getElementById('modalTitle').innerText = `‚ú® ${event.event}`;
    document.getElementById('modalBody').innerHTML = `
        <div style="background: var(--light-green); padding: 25px; border-radius: 20px; color: var(--primary-green); text-align: center;">
            <h1 style="font-size: 3rem; margin-bottom: 10px;">üáÆüá©</h1>
            <p style="font-weight: 600; line-height: 1.6;">${event.pesan}</p>
            <hr style="margin:15px 0; opacity:0.1; border:none; border-top:1px solid var(--primary-green);">
            <p style="font-size:0.7rem; opacity:0.8;">Ketuk tombol di bawah untuk lanjut eksplorasi.</p>
        </div>
    `;
    document.getElementById('modalOverlay').classList.add('active');
}



function copyFact(title, desc) {
    const text = `Tahukah kamu tentang ${title}? \n\n${desc}\n\nPelajari lebih lanjut di NusantaraEdu!`;
    navigator.clipboard.writeText(text);
    showNotif("Teks Disalin", "Info budaya siap dibagikan!", "‚úÖ");
}

function shareWa(title) {
    const url = `https://wa.me/?text=Halo! Cek budaya Indonesia yang keren ini: ${title}. Lihat selengkapnya di https://project-pkn.vercel.app/`;
    window.open(url, '_blank');
}

function showDevMenu() {
    toggleMenu(); 
    document.getElementById('modalTitle').innerText = "üöÄ Pusat Informasi Dev";

    document.getElementById('modalBody').innerHTML = `
        <style>
            @keyframes slideUp {
                from { opacity: 0; transform: translateY(20px); }
                to { opacity: 1; transform: translateY(0); }
            }
            .anim-item { animation: slideUp 0.5s ease forwards; opacity: 0; }
            .tab-btn { 
                padding: 8px 15px; border-radius: 20px; border: none; 
                font-size: 0.75rem; cursor: pointer; transition: 0.3s;
                background: #eee; color: #666;
            }
            .tab-btn.active { background: var(--primary-green); color: white; }
        </style>

        <div style="display: flex; justify-content: center; gap: 10px; margin-bottom: 25px;">
            <button id="tabDev" class="tab-btn active" onclick="switchDevTab('profil')">üë§ Profil</button>
            <button id="tabMitra" class="tab-btn" onclick="switchDevTab('mitra')">ü§ù Mitra Teknologi</button>
        </div>

        <div id="tabContent">
            <div class="anim-item" style="animation-delay: 0.1s; text-align: center;">
                <div style="width: 85px; height: 85px; background: linear-gradient(135deg, #2d6a4f, #1b4332); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px; font-size: 2.2rem; font-weight: bold; border: 3px solid var(--light-green); box-shadow: 0 8px 20px rgba(0,0,0,0.15);">
                    FD
                </div>
                <h3 style="color: var(--primary-green); font-family: 'Fredoka'; margin-bottom: 5px;">Fadhillah Dzaki Nasrullah</h3>
                <p style="font-size: 0.9rem; color: var(--orange-accent); font-weight: 700; letter-spacing: 0.5px; margin-bottom: 20px;">Ky Dev</p>
                
                <div style="background: var(--light-green); padding: 18px; border-radius: 20px; font-size: 0.85rem; color: var(--text-dark); line-height: 1.5; border-left: 5px solid var(--primary-green); text-align: left; margin-bottom: 20px;">
                    Aplikasi ini dikembangkan oleh <b>Fadhillah Dzaki Nasrullah</b> sebagai sarana edukasi digital mengenal kekayaan budaya Indonesia.
                </div>

                <div style="margin-top: 25px; padding-top: 15px; border-top: 1px solid #eee; font-size: 0.7rem; color: #888;">
                    Versi: <span style="color: var(--primary-green);">Supreme v1.1.0</span><br>
                    ¬© 2026 Ky Dev Studio
                </div>
            </div>
        </div>
    `;
    document.getElementById('modalOverlay').classList.add('active');
}

function showDevMenu() {
    toggleMenu(); 
    document.getElementById('modalTitle').innerText = "üèõÔ∏è HUB PENGEMBANG";

    document.getElementById('modalBody').innerHTML = `
        <style>
            @keyframes ultraFade {
                from { opacity: 0; transform: scale(0.95); }
                to { opacity: 1; transform: scale(1); }
            }
            .supreme-container { animation: ultraFade 0.4s ease-out forwards; }
            .tab-switcher { 
                display: flex; background: #eee; padding: 5px; border-radius: 15px; margin-bottom: 25px;
            }
            .tab-node { 
                flex: 1; padding: 12px; border-radius: 12px; border: none; 
                font-weight: 700; font-size: 0.85rem; cursor: pointer; transition: 0.3s;
            }
            .tab-node.active { background: white; color: var(--primary-green); shadow: 0 4px 10px rgba(0,0,0,0.1); }
            .big-card {
                background: white; border-radius: 25px; padding: 25px; 
                box-shadow: 0 10px 30px rgba(0,0,0,0.05); text-align: left;
            }
            .tech-pill {
                display: flex; align-items: center; gap: 15px; padding: 20px;
                border-radius: 20px; margin-bottom: 15px; border: 1px solid #f0f0f0;
            }
        </style>

        <div class="supreme-container">
            <div class="tab-switcher">
                <button id="btnP" class="tab-node active" onclick="goTab('p')">üë§ PROFIL</button>
                <button id="btnM" class="tab-node" onclick="goTab('m')">ü§ù MITRA</button>
            </div>

            <div id="bigContent">
                <div class="big-card">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="width: 100px; height: 100px; background: linear-gradient(135deg, #2d6a4f, #1b4332); color: white; border-radius: 35%; display: grid; place-items: center; margin: 0 auto 15px; font-size: 2.5rem; border: 4px solid var(--light-green); transform: rotate(-5deg);">
                            FD
                        </div>
                        <h2 style="color: var(--primary-green); font-family: 'Fredoka'; font-size: 1.5rem;">Fadhillah Dzaki Nasrullah</h2>
                        <span style="background: var(--orange-accent); color: white; padding: 4px 15px; border-radius: 50px; font-size: 0.7rem; font-weight: 800; letter-spacing: 2px;">CHIEF DEVELOPER</span>
                    </div>

                    <p style="font-size: 0.95rem; line-height: 1.7; color: #4a5568; border-left: 4px solid var(--mid-green); padding-left: 15px;">
                        Visi utama project ini adalah mendigitalisasi aset budaya Nusantara agar tetap relevan di mata generasi Z dan Alpha melalui teknologi web modern.
                    </p>

                    <div style="margin-top: 25px; background: #f8fdfa; padding: 15px; border-radius: 15px;">
                        <div style="display: flex; justify-content: space-between; font-size: 0.75rem; margin-bottom: 5px;">
                            <span>Project Status:</span> <b style="color: var(--primary-green);">SUPREME ACTIVE</b>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 0.75rem;">
                            <span>Engine Version:</span> <b>v1.1.0-2026</b>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
    document.getElementById('modalOverlay').classList.add('active');
}

function goTab(mode) {
    const box = document.getElementById('bigContent');
    const bP = document.getElementById('btnP');
    const bM = document.getElementById('btnM');

    if(mode === 'p') {
        bP.classList.add('active'); bM.classList.remove('active');
        box.innerHTML = `
            <div class="big-card" style="animation: ultraFade 0.4s ease;">
                <div style="text-align: center; margin-bottom: 20px;">
                    <div style="width: 100px; height: 100px; background: linear-gradient(135deg, #2d6a4f, #1b4332); color: white; border-radius: 35%; display: grid; place-items: center; margin: 0 auto 15px; font-size: 2.5rem; border: 4px solid var(--light-green); transform: rotate(-5deg);">FD</div>
                    <h2 style="color: var(--primary-green); font-family: 'Fredoka'; font-size: 1.5rem;">Fadhillah Dzaki Nasrullah</h2>
                    <span style="background: var(--orange-accent); color: white; padding: 4px 15px; border-radius: 50px; font-size: 0.7rem; font-weight: 800; letter-spacing: 2px;">CHIEF DEVELOPER</span>
                </div>
                <p style="font-size: 0.95rem; line-height: 1.7; color: #4a5568; border-left: 4px solid var(--mid-green); padding-left: 15px;">
                    Menggunakan kemampuan rekayasa perangkat lunak untuk melestarikan warisan leluhur Indonesia dalam satu platform edukasi yang interaktif.
                </p>
                <p style="text-align: center; font-size: 0.65rem; color: #bbb; margin-top: 20px;">¬© 2026 Ky Dev Studio - Klaten, Jawa Tengah</p>
            </div>
        `;
    } else {
        bM.classList.add('active'); bP.classList.remove('active');
        box.innerHTML = `
            <div style="animation: ultraFade 0.4s ease;">
                <div class="tech-pill" style="background: white;">
                    <div style="font-size: 2.5rem;">üåç</div>
                    <div>
                        <h3 style="font-size: 1.1rem; color: #2d3748;">Wikimedia API</h3>
                        <p style="font-size: 0.8rem; color: #718096; line-height: 1.5;">Penyedia data ensiklopedia terbesar. Tanpa Wikipedia, database NusantaraEdu tidak akan sepadat ini. Kami berterima kasih atas akses data publiknya.</p>
                    </div>
                </div>

                <div class="tech-pill" style="background: linear-gradient(135deg, #ffffff, #f0f7ff); border-color: #dbeafe;">
                    <div style="font-size: 2.5rem;">ü§ñ</div>
                    <div>
                        <h3 style="font-size: 1.1rem; color: #1e40af;">Google Gemini AI</h3>
                        <p style="font-size: 0.8rem; color: #3b82f6; line-height: 1.5;">Mitra Kecerdasan Buatan dalam menyempurnakan logika program, optimasi performa, dan teman diskusi kreatif selama proses perancangan aplikasi.</p>
                    </div>
                </div>

                <div style="background: var(--primary-green); color: white; padding: 20px; border-radius: 20px; text-align: center; margin-top: 10px;">
                    <p style="font-size: 0.85rem; font-weight: 600;">"Teknologi Global, Budaya Lokal."</p>
                </div>
            </div>
        `;
    }
}



const databaseKuis = [
    { q: "Apa nama candi Buddha terbesar di dunia yang ada di Magelang?", a: ["Borobudur", "Prambanan", "Mendut", "Cetho"], c: 0 },
    { q: "Makanan khas Sumatera Barat yang dinobatkan sebagai makanan terenak dunia adalah...", a: ["Sate", "Rendang", "Gudeg", "Pempek"], c: 1 },
    { q: "Alat musik bambu khas Jawa Barat yang diakui UNESCO adalah...", a: ["Gamelan", "Kolintang", "Angklung", "Sasando"], c: 2 },
    { q: "Rumah adat khas Papua disebut...", a: ["Joglo", "Gadang", "Honai", "Limas"], c: 2 },
    { q: "Tari Kecak berasal dari daerah...", a: ["Jawa Timur", "Bali", "Aceh", "Sulawesi"], c: 1 },
    { q: "Senjata tradisional khas Jawa Barat adalah...", a: ["Keris", "Kujang", "Rencong", "Mandau"], c: 1 },
    { q: "Lagu 'Apuse' berasal dari daerah...", a: ["Maluku", "Papua", "NTT", "Kalimantan"], c: 1 },
    { q: "Batik resmi diakui UNESCO sebagai warisan dunia pada tanggal...", a: ["2 Oktober", "17 Agustus", "10 November", "1 Juni"], c: 0 },
    { q: "Alat musik Sasando berasal dari daerah...", a: ["NTT", "NTB", "Maluku", "Sulawesi"], c: 0 },
    { q: "Tari Saman yang mengandalkan kecepatan tangan berasal dari...", a: ["Medan", "Padang", "Aceh", "Lampung"], c: 2 },
    { q: "Gudeg adalah makanan khas dari...", a: ["Solo", "Semarang", "Yogyakarta", "Surabaya"], c: 2 },
    { q: "Ibukota negara Indonesia saat ini adalah...", a: ["Surabaya", "Bandung", "Jakarta", "IKN"], c: 2 },
    { q: "Keris merupakan senjata tradisional yang dominan berasal dari pulau...", a: ["Sumatera", "Jawa", "Kalimantan", "Sulawesi"], c: 1 },
    { q: "Upacara pembakaran mayat di Bali disebut...", a: ["Ngaben", "Kasada", "Sekaten", "Lompat Batu"], c: 0 },
    { q: "Pempek adalah makanan khas daerah...", a: ["Jambi", "Palembang", "Lampung", "Bengkulu"], c: 1 },
    { q: "Tari Piring berasal dari provinsi...", a: ["Riau", "Sumatera Barat", "Sumatera Utara", "Kepulauan Riau"], c: 1 },
    { q: "Naskah proklamasi dirumuskan di rumah...", a: ["Soekarno", "Laksamana Maeda", "Hatta", "Ki Hajar Dewantara"], c: 1 },
    { q: "Batik Motif Megamendung berasal dari...", a: ["Solo", "Cirebon", "Pekalongan", "Madura"], c: 1 },
    { q: "Alat musik Tifa berasal dari...", a: ["Maluku & Papua", "Jawa", "Bali", "Sumatera"], c: 0 },
    { q: "Gunung tertinggi di Indonesia adalah...", a: ["Semeru", "Rinjani", "Puncak Jaya", "Kerinci"], c: 2 }
];

let kuisAcak = [];
let soalSekarang = 0;
let skor = 0;
let namaUser = "";

function startQuiz() {
    namaUser = prompt("Masukkan Nama Lengkapmu untuk Sertifikat:");
    if (!namaUser) return;

    toggleMenu();
    kuisAcak = [...databaseKuis].sort(() => Math.random() - 0.5); // Acak soal
    soalSekarang = 0;
    skor = 0;

    tampilkanSoal();
}

function tampilkanSoal() {
    const data = kuisAcak[soalSekarang];
    document.getElementById('modalTitle').innerText = `Pertanyaan ${soalSekarang + 1}/20`;

    let htmlPilihan = `<p style="margin-bottom:20px; font-weight:bold;">${data.q}</p>`;
    data.a.forEach((opt, idx) => {
        htmlPilihan += `<button class="quiz-option" onclick="cekJawaban(${idx})">${opt}</button>`;
    });

    document.getElementById('modalBody').innerHTML = htmlPilihan;
    document.getElementById('modalOverlay').classList.add('active');
}

function cekJawaban(idx) {
    const benarnya = kuisAcak[soalSekarang].c;
    const opsi = document.querySelectorAll('.quiz-option');

    if (idx === benarnya) {
        opsi[idx].classList.add('correct');
        skor += 5; // 5 poin x 20 soal = 100
    } else {
        opsi[idx].classList.add('wrong');
        opsi[benarnya].classList.add('correct');
    }

    // Delay sebentar sebelum lanjut
    setTimeout(() => {
        soalSekarang++;
        if (soalSekarang < kuisAcak.length) {
            tampilkanSoal();
        } else {
            tampilkanSertifikat();
        }
    }, 1000);
}

function tampilkanSertifikat() {
    document.getElementById('modalTitle').innerText = "üìú Sertifikat Selesai";
    const tgl = new Date().toLocaleDateString('id-ID', { day:'numeric', month:'long', year:'numeric' });

    // 1. Jalankan pengiriman otomatis ke Vercel tanpa API Key
    kirimSkorOtomatis(namaUser, skor);

    document.getElementById('modalBody').innerHTML = `
        <div id="certificate" style="background: #fff; border: 10px double var(--primary-green); padding: 30px; position: relative; color: #1b4332; font-family: 'serif';">
            <h2 style="font-family: 'Fredoka'; color: var(--primary-green);">SERTIFIKAT</h2>
            <p style="font-size: 0.8rem; margin: 10px 0;">Diberikan Kepada:</p>
            <h1 style="border-bottom: 2px solid #333; display: inline-block; padding: 0 20px; font-size: 1.5rem;">${namaUser}</h1>
            <p style="margin: 20px 0; font-size: 0.9rem;">Telah menyelesaikan Kuis Wawasan Budaya di <b>NusantaraEdu Supreme</b> dengan nilai:</p>
            <div class="score-circle">${skor}</div>
            <p style="font-size: 0.7rem; margin-top: 20px;">Diterbitkan pada: ${tgl}</p>
        </div>
        <div id="statusKirim" style="margin-top:15px; font-size:0.8rem; color:var(--mid-green); font-weight:bold;">
            ‚è≥ Mengirim skor ke papan peringkat...
        </div>
    `;
}

// FUNGSI JEMBATAN KE VERCEL
async function kirimSkorOtomatis(nama, nilai) {
    const statusEl = document.getElementById('statusKirim');
    
    // 1. Tampilan awal saat proses loading mulai
    statusEl.innerHTML = `
        <div style="margin-top:20px; text-align:center; padding:15px; background:rgba(0,0,0,0.02); border-radius:20px; border: 1px dashed #ddd;">
            <div class="load-bar" style="width:100%; height:8px; margin-bottom:15px; background:#eee; border-radius:10px; overflow:hidden;">
                <div class="load-progress-animate" style="height:100%; background:var(--orange-accent); width:30%;"></div>
            </div>
            
            <p style="color:var(--primary-green); font-size:0.85rem; font-weight:bold; margin-bottom:5px;">
                ‚è≥ Sinkronisasi Cloud...
            </p>
            
            <p style="font-size:0.75rem; color:#4a5568; line-height:1.4; margin-bottom:15px;">
                Sedang mengamankan skor ke database. Jika proses ini terasa lama, 
                <b>jangan khawatir</b>, skor akan tetap terkirim di latar belakang.
            </p>

            <button onclick="closeModal()" style="background:transparent; border:1px solid var(--mid-green); color:var(--mid-green); padding:8px 15px; border-radius:50px; font-size:0.7rem; font-weight:bold; cursor:pointer; transition: 0.3s;">
                Klik untuk Tutup (Tetap Kirim)
            </button>
            
            <p style="font-size:0.6rem; color:gray; margin-top:10px; font-style:italic;">
                *Papan peringkat akan terupdate otomatis dalam beberapa menit.
            </p>
        </div>
    `;

    try {
        const response = await fetch('/api/score', { 
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ nama: nama, skor: nilai })
        });

        const result = await response.json();

        // 2. Jika Berhasil
        if (response.ok) {
            statusEl.innerHTML = `
                <div style="background: #d1fae5; color: #065f46; padding: 15px; border-radius: 15px; margin-top: 15px; border: 1px solid #10b981; text-align:center;">
                    <b style="display:block; margin-bottom:5px;">‚úÖ SKOR TERCATAT!</b>
                    <p style="font-size:0.8rem;">Selamat ${nama}, namamu telah masuk dalam sejarah Patriot Budaya.</p>
                </div>
            `;
            showNotif("Sukses", "Skor kamu sudah tercatat!", "üèÜ");
        } else {
            // 3. Jika Server Error
            statusEl.innerHTML = `
                <div style="color:#991b1b; background:#fee2e2; padding:12px; border-radius:12px; margin-top:15px; font-size:0.8rem;">
                    ‚ùå <b>Gagal Kirim:</b> ${result.error || 'Server sedang sibuk'}. <br>
                    Tapi tenang, sertifikatmu tetap sah!
                </div>
            `;
        }
    } catch (err) {
        // 4. Jika Koneksi Putus/Lama Sekali (Timeout)
        statusEl.innerHTML = `
            <div style="color:#92400e; background:#fef3c7; padding:12px; border-radius:12px; margin-top:15px; font-size:0.75rem; border: 1px solid #f59e0b;">
                ‚ö†Ô∏è <b>Koneksi Kurang Stabil:</b> Pengiriman mungkin tertunda. <br>
                Silakan screenshot sertifikat ini sebagai bukti nilaimu.
            </div>
        `;
        console.error("Fetch Error:", err);
    }
}

// Mencegah Klik Kanan
document.addEventListener('contextmenu', (e) => {
    e.preventDefault();
    showNotif("Keamanan", "Klik kanan dinonaktifkan untuk melindungi konten", "üõ°Ô∏è");
});

// Mencegah Shortcut Inspect Element (F12, Ctrl+Shift+I, dll)
document.addEventListener('keydown', (e) => {
    if (
        e.key === "F12" || 
        (e.ctrlKey && e.shiftKey && (e.key === "I" || e.key === "J" || e.key === "C")) || 
        (e.ctrlKey && e.key === "U")
    ) {
        e.preventDefault();
        showNotif("Keamanan", "Akses pengembang dibatasi", "üö´");
    }
});

setInterval(function() {
    debugger;
}, 100);

let lastClickTime = 0;
function cekJawabanAman(idx) {
    const currentTime = new Date().getTime();
    if (currentTime - lastClickTime < 500) { // Jika klik kurang dari 0.5 detik
        showNotif("Sistem", "Terlalu cepat! Jangan terburu-buru.", "‚ö†Ô∏è");
        return;
    }
    lastClickTime = currentTime;
    // Jalankan logika cek jawaban asli di sini...
}

async function showLeaderboard() {
    toggleMenu();
    document.getElementById('modalTitle').innerText = "üèÜ Peringkat Patriot Budaya";
    document.getElementById('modalBody').innerHTML = "<p style='text-align:center; padding:20px;'>üåø Memuat peringkat...</p>";
    document.getElementById('modalOverlay').classList.add('active');

    try {
        // MENGGUNAKAN LINK RAW KAMU
        const url = 'https://raw.githubusercontent.com/kyy-dev/Project-PKN/refs/heads/main/leaderboard.json';

        // Ditambah timestamp (?t=) supaya data selalu fresh tidak nyangkut di cache HP
        const response = await fetch(url + '?t=' + new Date().getTime());

        if (!response.ok) throw new Error('Gagal ambil data');

        const daftarPeringkat = await response.json();

        // Urutkan otomatis skor tertinggi ke terendah
        daftarPeringkat.sort((a, b) => b.skor - a.skor);

        let html = `
            <div style="text-align:left;">
                <p style="font-size:0.8rem; margin-bottom:15px; text-align:center; opacity:0.7;">Update Real-time via GitHub Cloud</p>
                <table style="width:100%; border-collapse: collapse;">
                    <tr style="background:var(--primary-green); color:white;">
                        <th style="padding:10px; border-radius:10px 0 0 10px;">#</th>
                        <th style="padding:10px; text-align:left;">Nama</th>
                        <th style="padding:10px; border-radius:0 10px 10px 0;">Skor</th>
                    </tr>
        `;

        daftarPeringkat.forEach((p, i) => {
            let medali = i === 0 ? "ü•á" : i === 1 ? "ü•à" : i === 2 ? "ü•â" : (i + 1);
            html += `
                <tr style="border-bottom:1px solid #eee;">
                    <td style="padding:12px; text-align:center; font-weight:bold;">${medali}</td>
                    <td style="padding:12px;">${p.nama}</td>
                    <td style="padding:12px; text-align:center; font-weight:bold; color:var(--orange-accent);">${p.skor}</td>
                </tr>
            `;
        });

        html += `</table>
            <p style="font-size:0.7rem; margin-top:15px; color:gray; font-style:italic; text-align:center;">*Ingin namamu ada di sini? Selesaikan kuis dan kirim laporan nilai!</p>
        </div>`;

        document.getElementById('modalBody').innerHTML = html;

    } catch (error) {
        document.getElementById('modalBody').innerHTML = `
            <div style="text-align:center; padding:20px;">
                <p style="color:red; font-weight:bold;">Gagal memuat peringkat.</p>
                <p style="font-size:0.7rem; color:gray;">Pastikan repositori GitHub sudah Public dan internet aktif.</p>
            </div>
        `;
    }
}


function showBetaDownload() {
    toggleMenu(); // Tutup side menu dulu
    document.getElementById('modalTitle').innerText = "üöÄ Coba Versi Beta App";
    document.getElementById('modalBody').innerHTML = `
        <div style="text-align: center; padding: 10px;">
            <div style="font-size: 4rem; margin-bottom: 15px;">üì±</div>
            <p style="font-size: 0.9rem; color: var(--text-dark); margin-bottom: 20px;">
                Dapatkan pengalaman belajar budaya yang lebih lancar dan fitur kuis offline di versi aplikasi Android (APK).
            </p>
            
            <div style="background: #e7f3ff; color: #0056b3; padding: 15px; border-radius: 15px; font-size: 0.75rem; text-align: left; margin-bottom: 20px; border: 1px solid #b8daff;">
                <strong>Catatan Versi Beta:</strong><br>
                ‚Ä¢ Mungkin terdapat bug kecil.<br>
                ‚Ä¢ Beberapa fitur mungkin belum bekerja maksimal.<br>
                ‚Ä¢ Ukuran sangat ringan.
            </div>

            <a href="https://drive.google.com/file/d/1zaH7LPWOU32qF_2GpUuvEeqNYqEbmS0r/view?usp=drivesdk" target="_blank" 
               style="display: block; background: var(--primary-green); color: white; text-decoration: none; padding: 15px; border-radius: 50px; font-weight: bold; box-shadow: 0 4px 15px rgba(45, 106, 79, 0.3);">
                üì• Download APK (v1.0-beta)
            </a>
            
            <p style="font-size: 0.65rem; color: gray; margin-top: 15px;">
                Pastikan mengaktifkan "Install dari Sumber Tidak Dikenal" di pengaturan HP kamu.
            </p>
        </div>
    `;
    document.getElementById('modalOverlay').classList.add('active');
}

function showCredits() {
    toggleMenu();
    document.getElementById('modalTitle').innerText = "Apresiasi & Kredit";
    document.getElementById('modalBody').innerHTML = `
        <div style="text-align: left; font-size: 0.85rem; line-height: 1.6;">
            <p style="margin-bottom: 20px; opacity: 0.8;">
                Keberhasilan <b>NusantaraEdu</b> dalam menyajikan informasi budaya tidak lepas dari dukungan teknologi hebat berikut:
            </p>

            <div style="background: white; padding: 15px; border-radius: 20px; border: 1px solid #eee; margin-bottom: 12px; display: flex; align-items: center; gap: 15px;">
                <div style="font-size: 1.5rem;">üìö</div>
                <div>
                    <strong style="color: var(--primary-green); display: block;">Wikimedia Foundation</strong>
                    <span style="font-size: 0.7rem; color: #718096;">Penyedia akses data melalui Wikipedia API yang memungkinkan kami menyajikan ribuan artikel budaya Nusantara secara gratis.</span>
                </div>
            </div>

            <div style="background: linear-gradient(135deg, #f0f7ff, #e0e7ff); padding: 15px; border-radius: 20px; border: 1px solid #c3dafe; margin-bottom: 20px; display: flex; align-items: center; gap: 15px;">
                <div style="font-size: 1.5rem;">‚ú®</div>
                <div>
                    <strong style="color: #1e40af; display: block;">Google Gemini AI</strong>
                    <span style="font-size: 0.7rem; color: #3730a3;">Asisten cerdas yang membimbing pengembangan logika aplikasi, optimalisasi kode, hingga penyusunan konten yang edukatif.</span>
                </div>
            </div>

            <div style="background: var(--light-green); padding: 15px; border-radius: 15px; text-align: center;">
                <p style="font-weight: bold; color: var(--primary-green); margin-bottom: 5px;">Terima Kasih!</p>
                <p style="font-size: 0.7rem;">Atas kontribusi dalam memajukan literasi budaya digital di Indonesia.</p>
            </div>
        </div>
    `;
    document.getElementById('modalOverlay').classList.add('active');
}

    </script>
<script defer src="/_vercel/insights/script.js"></script>
</body>
</html>